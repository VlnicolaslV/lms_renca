{"ast":null,"code":"import axios from 'axios';\nconst API_URL = 'http://localhost:8000/api/usuario/';\nconst login = async (rut, password) => {\n  try {\n    const response = await axios.post(API_URL + 'token/', {\n      // O la URL que uses para obtener el token JWT\n      rut,\n      password\n    });\n\n    // Verifica y guarda los tokens\n    if (response.data.access && response.data.refresh) {\n      console.log(\"Tokens recibidos:\", response.data);\n      localStorage.setItem('token', response.data.access);\n      document.cookie = `refresh=${response.data.refresh}; path=/`;\n    } else {\n      console.error(\"Falta el token de acceso o de actualización.\");\n    }\n    return response.data;\n  } catch (error) {\n    console.error(\"Error al iniciar sesión:\", error);\n    throw error; // Re-lanzar el error para manejarlo en el componente\n  }\n};\nconst getUserData = async () => {\n  try {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      throw new Error('No se ha encontrado un token de acceso');\n    }\n    const response = await axios.get(API_URL + 'profile/', {\n      headers: {\n        'Authorization': `Bearer ${token}` // Enviar el token JWT con Bearer\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error(\"Error al obtener los datos del usuario:\", error);\n    throw error; // Re-lanzar el error para manejarlo en el componente\n  }\n};\nconst cerrarSesion = async () => {\n  try {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      throw new Error('No se ha encontrado un token de acceso');\n    }\n\n    // Depuración: Mostrar las cookies actuales\n    console.log(\"Cookies actuales antes de logout:\", document.cookie);\n    const refreshCookie = document.cookie.split('; ').find(row => row.startsWith('refresh='));\n    if (!refreshCookie) {\n      throw new Error('No se ha encontrado un token de actualización');\n    }\n    const refreshToken = refreshCookie.split('=')[1];\n    await axios.post(API_URL + 'cerrar_sesion/', {\n      refresh: refreshToken\n    }, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    // Eliminar los tokens del almacenamiento local y cookies\n    localStorage.removeItem('token');\n    document.cookie = 'csrftoken=; Max-Age=0';\n    document.cookie = 'refresh=; Max-Age=0';\n    alert(\"Sesión cerrada exitosamente\");\n  } catch (error) {\n    console.error(\"Error al cerrar sesión:\", error);\n    throw error;\n  }\n};\nconst authService = {\n  login,\n  getUserData,\n  cerrarSesion // Agregar la función cerrarSesion al servicio\n};\nexport default authService;","map":{"version":3,"names":["axios","API_URL","login","rut","password","response","post","data","access","refresh","console","log","localStorage","setItem","document","cookie","error","getUserData","token","getItem","Error","get","headers","cerrarSesion","refreshCookie","split","find","row","startsWith","refreshToken","removeItem","alert","authService"],"sources":["C:/Users/aggro/OneDrive/Desktop/LMS/lms_renca_frontend/src/services/authService.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000/api/usuario/';\r\n\r\nconst login = async (rut, password) => {\r\n  try {\r\n    const response = await axios.post(API_URL + 'token/', { // O la URL que uses para obtener el token JWT\r\n      rut,\r\n      password,\r\n    });\r\n\r\n    // Verifica y guarda los tokens\r\n    if (response.data.access && response.data.refresh) {\r\n      console.log(\"Tokens recibidos:\", response.data);\r\n      localStorage.setItem('token', response.data.access);\r\n      document.cookie = `refresh=${response.data.refresh}; path=/`;\r\n    } else {\r\n      console.error(\"Falta el token de acceso o de actualización.\");\r\n    }\r\n\r\n    return response.data; \r\n  } catch (error) {\r\n    console.error(\"Error al iniciar sesión:\", error);\r\n    throw error; // Re-lanzar el error para manejarlo en el componente\r\n  }\r\n};\r\n\r\nconst getUserData = async () => {\r\n  try {\r\n    const token = localStorage.getItem('token');\r\n    \r\n    if (!token) {\r\n      throw new Error('No se ha encontrado un token de acceso');\r\n    }\r\n    \r\n    const response = await axios.get(API_URL + 'profile/', {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}` // Enviar el token JWT con Bearer\r\n      }\r\n    });\r\n    \r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error al obtener los datos del usuario:\", error);\r\n    throw error; // Re-lanzar el error para manejarlo en el componente\r\n  }\r\n};\r\n\r\nconst cerrarSesion = async () => {\r\n  try {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      throw new Error('No se ha encontrado un token de acceso');\r\n    }\r\n\r\n    // Depuración: Mostrar las cookies actuales\r\n    console.log(\"Cookies actuales antes de logout:\", document.cookie);\r\n\r\n    const refreshCookie = document.cookie.split('; ').find(row => row.startsWith('refresh='));\r\n    if (!refreshCookie) {\r\n      throw new Error('No se ha encontrado un token de actualización');\r\n    }\r\n\r\n    const refreshToken = refreshCookie.split('=')[1];\r\n\r\n    await axios.post(API_URL + 'cerrar_sesion/', { refresh: refreshToken }, {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n\r\n    // Eliminar los tokens del almacenamiento local y cookies\r\n    localStorage.removeItem('token');\r\n    document.cookie = 'csrftoken=; Max-Age=0';\r\n    document.cookie = 'refresh=; Max-Age=0';\r\n\r\n    alert(\"Sesión cerrada exitosamente\");\r\n  } catch (error) {\r\n    console.error(\"Error al cerrar sesión:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\nconst authService = {\r\n  login,\r\n  getUserData,\r\n  cerrarSesion, // Agregar la función cerrarSesion al servicio\r\n};\r\n\r\nexport default authService;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}