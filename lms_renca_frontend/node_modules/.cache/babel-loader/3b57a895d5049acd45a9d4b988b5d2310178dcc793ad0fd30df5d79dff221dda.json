{"ast":null,"code":"import axios from 'axios';\nconst API_URL = 'http://localhost:8000/api/usuario/';\nconst login = async (rut, password) => {\n  try {\n    const response = await axios.post(API_URL + 'token/', {\n      // O la URL que uses para obtener el token JWT\n      rut,\n      password\n    });\n\n    // Guardar el token JWT en localStorage\n    localStorage.setItem('token', response.data.access); // Asumiendo que la respuesta tiene un campo 'access' con el token\n    // Guardar el token de actualización en las cookies\n    document.cookie = `refresh=${response.data.refresh}; path=/`;\n    return response.data;\n  } catch (error) {\n    console.error(\"Error al iniciar sesión:\", error);\n    throw error; // Re-lanzar el error para manejarlo en el componente\n  }\n};\nconst getUserData = async () => {\n  try {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      throw new Error('No se ha encontrado un token de acceso');\n    }\n    const response = await axios.get(API_URL + 'profile/', {\n      headers: {\n        'Authorization': `Bearer ${token}` // Enviar el token JWT con Bearer\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error(\"Error al obtener los datos del usuario:\", error);\n    throw error; // Re-lanzar el error para manejarlo en el componente\n  }\n};\nconst cerrarSesion = async () => {\n  try {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      throw new Error('No se ha encontrado un token de acceso');\n    }\n    const refreshCookie = document.cookie.split('; ').find(row => row.startsWith('refresh='));\n    if (!refreshCookie) {\n      throw new Error('No se ha encontrado un token de actualización');\n    }\n    const refreshToken = refreshCookie.split('=')[1];\n    await axios.post(API_URL + 'cerrar_sesion/', {\n      refresh: refreshToken\n    }, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    // Eliminar los tokens del almacenamiento local y cookies\n    localStorage.removeItem('token');\n    document.cookie = 'csrftoken=; Max-Age=0';\n    document.cookie = 'refresh=; Max-Age=0';\n    alert(\"Sesión cerrada exitosamente\");\n  } catch (error) {\n    console.error(\"Error al cerrar sesión:\", error);\n    throw error;\n  }\n};\nconst authService = {\n  login,\n  getUserData,\n  cerrarSesion // Agregar la función cerrarSesion al servicio\n};\nexport default authService;","map":{"version":3,"names":["axios","API_URL","login","rut","password","response","post","localStorage","setItem","data","access","document","cookie","refresh","error","console","getUserData","token","getItem","Error","get","headers","cerrarSesion","refreshCookie","split","find","row","startsWith","refreshToken","removeItem","alert","authService"],"sources":["C:/Users/aggro/OneDrive/Desktop/LMS/lms_renca_frontend/src/services/authService.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000/api/usuario/';\r\n\r\nconst login = async (rut, password) => {\r\n  try {\r\n    const response = await axios.post(API_URL + 'token/', { // O la URL que uses para obtener el token JWT\r\n      rut,\r\n      password,\r\n    });\r\n    \r\n    // Guardar el token JWT en localStorage\r\n    localStorage.setItem('token', response.data.access); // Asumiendo que la respuesta tiene un campo 'access' con el token\r\n    // Guardar el token de actualización en las cookies\r\n    document.cookie = `refresh=${response.data.refresh}; path=/`;\r\n\r\n    return response.data; \r\n  } catch (error) {\r\n    console.error(\"Error al iniciar sesión:\", error);\r\n    throw error; // Re-lanzar el error para manejarlo en el componente\r\n  }\r\n};\r\n\r\nconst getUserData = async () => {\r\n  try {\r\n    const token = localStorage.getItem('token');\r\n    \r\n    if (!token) {\r\n      throw new Error('No se ha encontrado un token de acceso');\r\n    }\r\n    \r\n    const response = await axios.get(API_URL + 'profile/', {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}` // Enviar el token JWT con Bearer\r\n      }\r\n    });\r\n    \r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error al obtener los datos del usuario:\", error);\r\n    throw error; // Re-lanzar el error para manejarlo en el componente\r\n  }\r\n};\r\n\r\nconst cerrarSesion = async () => {\r\n  try {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      throw new Error('No se ha encontrado un token de acceso');\r\n    }\r\n\r\n    const refreshCookie = document.cookie.split('; ').find(row => row.startsWith('refresh='));\r\n    if (!refreshCookie) {\r\n      throw new Error('No se ha encontrado un token de actualización');\r\n    }\r\n\r\n    const refreshToken = refreshCookie.split('=')[1];\r\n\r\n    await axios.post(API_URL + 'cerrar_sesion/', { refresh: refreshToken }, {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n\r\n    // Eliminar los tokens del almacenamiento local y cookies\r\n    localStorage.removeItem('token');\r\n    document.cookie = 'csrftoken=; Max-Age=0';\r\n    document.cookie = 'refresh=; Max-Age=0';\r\n\r\n    alert(\"Sesión cerrada exitosamente\");\r\n  } catch (error) {\r\n    console.error(\"Error al cerrar sesión:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst authService = {\r\n  login,\r\n  getUserData,\r\n  cerrarSesion, // Agregar la función cerrarSesion al servicio\r\n};\r\n\r\nexport default authService;\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,OAAO,GAAG,oCAAoC;AAEpD,MAAMC,KAAK,GAAG,MAAAA,CAAOC,GAAG,EAAEC,QAAQ,KAAK;EACrC,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAML,KAAK,CAACM,IAAI,CAACL,OAAO,GAAG,QAAQ,EAAE;MAAE;MACtDE,GAAG;MACHC;IACF,CAAC,CAAC;;IAEF;IACAG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEH,QAAQ,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;IACrD;IACAC,QAAQ,CAACC,MAAM,GAAG,WAAWP,QAAQ,CAACI,IAAI,CAACI,OAAO,UAAU;IAE5D,OAAOR,QAAQ,CAACI,IAAI;EACtB,CAAC,CAAC,OAAOK,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChD,MAAMA,KAAK,CAAC,CAAC;EACf;AACF,CAAC;AAED,MAAME,WAAW,GAAG,MAAAA,CAAA,KAAY;EAC9B,IAAI;IACF,MAAMC,KAAK,GAAGV,YAAY,CAACW,OAAO,CAAC,OAAO,CAAC;IAE3C,IAAI,CAACD,KAAK,EAAE;MACV,MAAM,IAAIE,KAAK,CAAC,wCAAwC,CAAC;IAC3D;IAEA,MAAMd,QAAQ,GAAG,MAAML,KAAK,CAACoB,GAAG,CAACnB,OAAO,GAAG,UAAU,EAAE;MACrDoB,OAAO,EAAE;QACP,eAAe,EAAE,UAAUJ,KAAK,EAAE,CAAC;MACrC;IACF,CAAC,CAAC;IAEF,OAAOZ,QAAQ,CAACI,IAAI;EACtB,CAAC,CAAC,OAAOK,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;IAC/D,MAAMA,KAAK,CAAC,CAAC;EACf;AACF,CAAC;AAED,MAAMQ,YAAY,GAAG,MAAAA,CAAA,KAAY;EAC/B,IAAI;IACF,MAAML,KAAK,GAAGV,YAAY,CAACW,OAAO,CAAC,OAAO,CAAC;IAC3C,IAAI,CAACD,KAAK,EAAE;MACV,MAAM,IAAIE,KAAK,CAAC,wCAAwC,CAAC;IAC3D;IAEA,MAAMI,aAAa,GAAGZ,QAAQ,CAACC,MAAM,CAACY,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,UAAU,CAAC,UAAU,CAAC,CAAC;IACzF,IAAI,CAACJ,aAAa,EAAE;MAClB,MAAM,IAAIJ,KAAK,CAAC,+CAA+C,CAAC;IAClE;IAEA,MAAMS,YAAY,GAAGL,aAAa,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAEhD,MAAMxB,KAAK,CAACM,IAAI,CAACL,OAAO,GAAG,gBAAgB,EAAE;MAAEY,OAAO,EAAEe;IAAa,CAAC,EAAE;MACtEP,OAAO,EAAE;QACP,eAAe,EAAE,UAAUJ,KAAK;MAClC;IACF,CAAC,CAAC;;IAEF;IACAV,YAAY,CAACsB,UAAU,CAAC,OAAO,CAAC;IAChClB,QAAQ,CAACC,MAAM,GAAG,uBAAuB;IACzCD,QAAQ,CAACC,MAAM,GAAG,qBAAqB;IAEvCkB,KAAK,CAAC,6BAA6B,CAAC;EACtC,CAAC,CAAC,OAAOhB,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IAC/C,MAAMA,KAAK;EACb;AACF,CAAC;AAED,MAAMiB,WAAW,GAAG;EAClB7B,KAAK;EACLc,WAAW;EACXM,YAAY,CAAE;AAChB,CAAC;AAED,eAAeS,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}