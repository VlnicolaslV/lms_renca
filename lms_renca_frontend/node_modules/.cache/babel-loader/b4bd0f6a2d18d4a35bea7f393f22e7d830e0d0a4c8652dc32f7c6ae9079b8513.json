{"ast":null,"code":"import React,{useState,useEffect}from'react';import profesorService from'../../services/profesorService';import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import'./profesorCss/verAsistencia.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const VerAsistencias=_ref=>{let{idCursoAsignatura}=_ref;const[alumnos,setAlumnos]=useState([]);const[asignaturaNombre,setAsignaturaNombre]=useState(\"\");const[cursoNombre,setCursoNombre]=useState(\"\");const[cursoGrado,setCursoGrado]=useState(\"\");const[fecha,setFecha]=useState('');const[presencias,setPresencias]=useState({});useEffect(()=>{const fetchCurso=async()=>{try{const cursoData=await profesorService.obtenerCursoAsignatura(idCursoAsignatura);if(cursoData){setAsignaturaNombre(cursoData.asignatura_nombre||'Sin nombre');setCursoNombre(cursoData.curso_nombre||'Sin nombre');setCursoGrado(cursoData.curso_grado||'Sin grado');const inscripcionesData=await profesorService.obtenerEstudiantes(cursoData.id);setAlumnos(inscripcionesData.map(estudiante=>({id:estudiante.id,rut:estudiante.estudiante_rut,nombre:estudiante.estudiante_nombre,apellido:estudiante.estudiante_apellido})));}}catch(error){console.error(\"Error al obtener el curso y alumnos:\",error);}};fetchCurso();},[idCursoAsignatura]);const handleFechaChange=e=>{setFecha(e.target.value);console.log(`Fecha seleccionada: ${e.target.value}`);};const handlePresenciaChange=idEstudiante=>{setPresencias(prevState=>({...prevState,[idEstudiante]:!prevState[idEstudiante]}));console.log(`Cambiar presencia para estudiante ID ${idEstudiante}: ${!presencias[idEstudiante]}`);};const crearAsistencia=async()=>{try{for(const idEstudiante in presencias){if(presencias.hasOwnProperty(idEstudiante)){const alumno=alumnos.find(alumno=>alumno.id===parseInt(idEstudiante));if(alumno){console.log(`Enviando asistencia para ${alumno.rut}: ${presencias[idEstudiante]}`);await profesorService.tomarAsistencia(idCursoAsignatura,alumno.rut,{fecha,presente:presencias[idEstudiante]});}}}toast.success('¡Asistencia creada exitosamente!',{position:\"top-right\",autoClose:3000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});}catch(error){toast.error('Error al crear la asistencia. Intenta nuevamente.',{position:\"top-right\",autoClose:3000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});console.error(\"Error al crear las asistencias:\",error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"curso-detalle-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[asignaturaNombre,\" \",cursoNombre,\" - \",cursoGrado]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Libro de Asistencias\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tabla-container\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Fecha: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:fecha,onChange:handleFechaChange})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"tabla-alumnos\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"RUT\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nombre Apellido\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Asistencia\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:alumnos.map(alumno=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:alumno.rut}),/*#__PURE__*/_jsxs(\"td\",{children:[alumno.nombre,\" \",alumno.apellido]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{style:{backgroundColor:presencias[alumno.id]?'green':'red'},onClick:()=>handlePresenciaChange(alumno.id),children:presencias[alumno.id]?'Presente':'Ausente'})})]},alumno.id))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"button-create\",onClick:crearAsistencia,children:\"Crear Asistencia\"})]}),/*#__PURE__*/_jsx(ToastContainer,{})]});};export default VerAsistencias;","map":{"version":3,"names":["React","useState","useEffect","profesorService","ToastContainer","toast","jsxs","_jsxs","jsx","_jsx","VerAsistencias","_ref","idCursoAsignatura","alumnos","setAlumnos","asignaturaNombre","setAsignaturaNombre","cursoNombre","setCursoNombre","cursoGrado","setCursoGrado","fecha","setFecha","presencias","setPresencias","fetchCurso","cursoData","obtenerCursoAsignatura","asignatura_nombre","curso_nombre","curso_grado","inscripcionesData","obtenerEstudiantes","id","map","estudiante","rut","estudiante_rut","nombre","estudiante_nombre","apellido","estudiante_apellido","error","console","handleFechaChange","e","target","value","log","handlePresenciaChange","idEstudiante","prevState","crearAsistencia","hasOwnProperty","alumno","find","parseInt","tomarAsistencia","presente","success","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","className","children","type","onChange","style","backgroundColor","onClick"],"sources":["C:/Users/aggro/OneDrive/Desktop/Nueva carpeta (3)/LMS/lms_renca_frontend/src/components/profesor/VerAsistencias.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport profesorService from '../../services/profesorService';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport './profesorCss/verAsistencia.css';\r\n\r\nconst VerAsistencias = ({ idCursoAsignatura }) => {\r\n    const [alumnos, setAlumnos] = useState([]);\r\n    const [asignaturaNombre, setAsignaturaNombre] = useState(\"\");\r\n    const [cursoNombre, setCursoNombre] = useState(\"\");\r\n    const [cursoGrado, setCursoGrado] = useState(\"\");\r\n    const [fecha, setFecha] = useState('');\r\n    const [presencias, setPresencias] = useState({});\r\n\r\n    useEffect(() => {\r\n        const fetchCurso = async () => {\r\n            try {\r\n                const cursoData = await profesorService.obtenerCursoAsignatura(idCursoAsignatura);\r\n                if (cursoData) {\r\n                    setAsignaturaNombre(cursoData.asignatura_nombre || 'Sin nombre');\r\n                    setCursoNombre(cursoData.curso_nombre || 'Sin nombre');\r\n                    setCursoGrado(cursoData.curso_grado || 'Sin grado');\r\n                    const inscripcionesData = await profesorService.obtenerEstudiantes(cursoData.id);\r\n                    setAlumnos(inscripcionesData.map(estudiante => ({\r\n                        id: estudiante.id,\r\n                        rut: estudiante.estudiante_rut,\r\n                        nombre: estudiante.estudiante_nombre,\r\n                        apellido: estudiante.estudiante_apellido,\r\n                    })));\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error al obtener el curso y alumnos:\", error);\r\n            }\r\n        };\r\n        fetchCurso();\r\n    }, [idCursoAsignatura]);\r\n\r\n    const handleFechaChange = (e) => {\r\n        setFecha(e.target.value);\r\n        console.log(`Fecha seleccionada: ${e.target.value}`);\r\n    };\r\n\r\n    const handlePresenciaChange = (idEstudiante) => {\r\n        setPresencias(prevState => ({\r\n            ...prevState,\r\n            [idEstudiante]: !prevState[idEstudiante],\r\n        }));\r\n        console.log(`Cambiar presencia para estudiante ID ${idEstudiante}: ${!presencias[idEstudiante]}`);\r\n    };\r\n\r\n    const crearAsistencia = async () => {\r\n        try {\r\n            for (const idEstudiante in presencias) {\r\n                if (presencias.hasOwnProperty(idEstudiante)) {\r\n                    const alumno = alumnos.find(alumno => alumno.id === parseInt(idEstudiante));\r\n                    if (alumno) {\r\n                        console.log(`Enviando asistencia para ${alumno.rut}: ${presencias[idEstudiante]}`);\r\n                        await profesorService.tomarAsistencia(\r\n                            idCursoAsignatura,\r\n                            alumno.rut,\r\n                            { fecha, presente: presencias[idEstudiante] }\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n            toast.success('¡Asistencia creada exitosamente!', {\r\n                position: \"top-right\",\r\n                autoClose: 3000,\r\n                hideProgressBar: false,\r\n                closeOnClick: true,\r\n                pauseOnHover: true,\r\n                draggable: true,\r\n                progress: undefined,\r\n            });\r\n        } catch (error) {\r\n            toast.error('Error al crear la asistencia. Intenta nuevamente.', {\r\n                position: \"top-right\",\r\n                autoClose: 3000,\r\n                hideProgressBar: false,\r\n                closeOnClick: true,\r\n                pauseOnHover: true,\r\n                draggable: true,\r\n                progress: undefined,\r\n            });\r\n            console.error(\"Error al crear las asistencias:\", error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"curso-detalle-container\">\r\n            <div className=\"header\">\r\n                <h2>{asignaturaNombre} {cursoNombre} - {cursoGrado}</h2>\r\n                <h3>Libro de Asistencias</h3>\r\n            </div>\r\n            <div className=\"tabla-container\">\r\n                <div>\r\n                    <label>Fecha: </label>\r\n                    <input type=\"date\" value={fecha} onChange={handleFechaChange} />\r\n                </div>\r\n                <table className=\"tabla-alumnos\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>RUT</th>\r\n                            <th>Nombre Apellido</th>\r\n                            <th>Asistencia</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {alumnos.map((alumno) => (\r\n                            <tr key={alumno.id}>\r\n                                <td>{alumno.rut}</td>\r\n                                <td>{alumno.nombre} {alumno.apellido}</td>\r\n                                <td>\r\n                                    <button\r\n                                        style={{ backgroundColor: presencias[alumno.id] ? 'green' : 'red' }}\r\n                                        onClick={() => handlePresenciaChange(alumno.id)}\r\n                                    >\r\n                                        {presencias[alumno.id] ? 'Presente' : 'Ausente'}\r\n                                    </button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n                <button className=\"button-create\" onClick={crearAsistencia}>Crear Asistencia</button>\r\n            </div>\r\n            <ToastContainer />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VerAsistencias;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,eAAe,KAAM,gCAAgC,CAC5D,OAASC,cAAc,CAAEC,KAAK,KAAQ,gBAAgB,CACtD,MAAO,uCAAuC,CAC9C,MAAO,iCAAiC,CAAC,OAAAC,IAAA,IAAAC,KAAA,CAAAC,GAAA,IAAAC,IAAA,yBAEzC,KAAM,CAAAC,cAAc,CAAGC,IAAA,EAA2B,IAA1B,CAAEC,iBAAkB,CAAC,CAAAD,IAAA,CACzC,KAAM,CAACE,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACc,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAACgB,WAAW,CAAEC,cAAc,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACkB,UAAU,CAAEC,aAAa,CAAC,CAAGnB,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACoB,KAAK,CAAEC,QAAQ,CAAC,CAAGrB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACsB,UAAU,CAAEC,aAAa,CAAC,CAAGvB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAEhDC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAuB,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CACA,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAvB,eAAe,CAACwB,sBAAsB,CAACf,iBAAiB,CAAC,CACjF,GAAIc,SAAS,CAAE,CACXV,mBAAmB,CAACU,SAAS,CAACE,iBAAiB,EAAI,YAAY,CAAC,CAChEV,cAAc,CAACQ,SAAS,CAACG,YAAY,EAAI,YAAY,CAAC,CACtDT,aAAa,CAACM,SAAS,CAACI,WAAW,EAAI,WAAW,CAAC,CACnD,KAAM,CAAAC,iBAAiB,CAAG,KAAM,CAAA5B,eAAe,CAAC6B,kBAAkB,CAACN,SAAS,CAACO,EAAE,CAAC,CAChFnB,UAAU,CAACiB,iBAAiB,CAACG,GAAG,CAACC,UAAU,GAAK,CAC5CF,EAAE,CAAEE,UAAU,CAACF,EAAE,CACjBG,GAAG,CAAED,UAAU,CAACE,cAAc,CAC9BC,MAAM,CAAEH,UAAU,CAACI,iBAAiB,CACpCC,QAAQ,CAAEL,UAAU,CAACM,mBACzB,CAAC,CAAC,CAAC,CAAC,CACR,CACJ,CAAE,MAAOC,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,sCAAsC,CAAEA,KAAK,CAAC,CAChE,CACJ,CAAC,CACDjB,UAAU,CAAC,CAAC,CAChB,CAAC,CAAE,CAACb,iBAAiB,CAAC,CAAC,CAEvB,KAAM,CAAAgC,iBAAiB,CAAIC,CAAC,EAAK,CAC7BvB,QAAQ,CAACuB,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CACxBJ,OAAO,CAACK,GAAG,CAAC,uBAAuBH,CAAC,CAACC,MAAM,CAACC,KAAK,EAAE,CAAC,CACxD,CAAC,CAED,KAAM,CAAAE,qBAAqB,CAAIC,YAAY,EAAK,CAC5C1B,aAAa,CAAC2B,SAAS,GAAK,CACxB,GAAGA,SAAS,CACZ,CAACD,YAAY,EAAG,CAACC,SAAS,CAACD,YAAY,CAC3C,CAAC,CAAC,CAAC,CACHP,OAAO,CAACK,GAAG,CAAC,wCAAwCE,YAAY,KAAK,CAAC3B,UAAU,CAAC2B,YAAY,CAAC,EAAE,CAAC,CACrG,CAAC,CAED,KAAM,CAAAE,eAAe,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACA,IAAK,KAAM,CAAAF,YAAY,GAAI,CAAA3B,UAAU,CAAE,CACnC,GAAIA,UAAU,CAAC8B,cAAc,CAACH,YAAY,CAAC,CAAE,CACzC,KAAM,CAAAI,MAAM,CAAGzC,OAAO,CAAC0C,IAAI,CAACD,MAAM,EAAIA,MAAM,CAACrB,EAAE,GAAKuB,QAAQ,CAACN,YAAY,CAAC,CAAC,CAC3E,GAAII,MAAM,CAAE,CACRX,OAAO,CAACK,GAAG,CAAC,4BAA4BM,MAAM,CAAClB,GAAG,KAAKb,UAAU,CAAC2B,YAAY,CAAC,EAAE,CAAC,CAClF,KAAM,CAAA/C,eAAe,CAACsD,eAAe,CACjC7C,iBAAiB,CACjB0C,MAAM,CAAClB,GAAG,CACV,CAAEf,KAAK,CAAEqC,QAAQ,CAAEnC,UAAU,CAAC2B,YAAY,CAAE,CAChD,CAAC,CACL,CACJ,CACJ,CACA7C,KAAK,CAACsD,OAAO,CAAC,kCAAkC,CAAE,CAC9CC,QAAQ,CAAE,WAAW,CACrBC,SAAS,CAAE,IAAI,CACfC,eAAe,CAAE,KAAK,CACtBC,YAAY,CAAE,IAAI,CAClBC,YAAY,CAAE,IAAI,CAClBC,SAAS,CAAE,IAAI,CACfC,QAAQ,CAAEC,SACd,CAAC,CAAC,CACN,CAAE,MAAOzB,KAAK,CAAE,CACZrC,KAAK,CAACqC,KAAK,CAAC,mDAAmD,CAAE,CAC7DkB,QAAQ,CAAE,WAAW,CACrBC,SAAS,CAAE,IAAI,CACfC,eAAe,CAAE,KAAK,CACtBC,YAAY,CAAE,IAAI,CAClBC,YAAY,CAAE,IAAI,CAClBC,SAAS,CAAE,IAAI,CACfC,QAAQ,CAAEC,SACd,CAAC,CAAC,CACFxB,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CAC3D,CACJ,CAAC,CAED,mBACInC,KAAA,QAAK6D,SAAS,CAAC,yBAAyB,CAAAC,QAAA,eACpC9D,KAAA,QAAK6D,SAAS,CAAC,QAAQ,CAAAC,QAAA,eACnB9D,KAAA,OAAA8D,QAAA,EAAKtD,gBAAgB,CAAC,GAAC,CAACE,WAAW,CAAC,KAAG,CAACE,UAAU,EAAK,CAAC,cACxDV,IAAA,OAAA4D,QAAA,CAAI,sBAAoB,CAAI,CAAC,EAC5B,CAAC,cACN9D,KAAA,QAAK6D,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC5B9D,KAAA,QAAA8D,QAAA,eACI5D,IAAA,UAAA4D,QAAA,CAAO,SAAO,CAAO,CAAC,cACtB5D,IAAA,UAAO6D,IAAI,CAAC,MAAM,CAACvB,KAAK,CAAE1B,KAAM,CAACkD,QAAQ,CAAE3B,iBAAkB,CAAE,CAAC,EAC/D,CAAC,cACNrC,KAAA,UAAO6D,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5B5D,IAAA,UAAA4D,QAAA,cACI9D,KAAA,OAAA8D,QAAA,eACI5D,IAAA,OAAA4D,QAAA,CAAI,KAAG,CAAI,CAAC,cACZ5D,IAAA,OAAA4D,QAAA,CAAI,iBAAe,CAAI,CAAC,cACxB5D,IAAA,OAAA4D,QAAA,CAAI,YAAU,CAAI,CAAC,EACnB,CAAC,CACF,CAAC,cACR5D,IAAA,UAAA4D,QAAA,CACKxD,OAAO,CAACqB,GAAG,CAAEoB,MAAM,eAChB/C,KAAA,OAAA8D,QAAA,eACI5D,IAAA,OAAA4D,QAAA,CAAKf,MAAM,CAAClB,GAAG,CAAK,CAAC,cACrB7B,KAAA,OAAA8D,QAAA,EAAKf,MAAM,CAAChB,MAAM,CAAC,GAAC,CAACgB,MAAM,CAACd,QAAQ,EAAK,CAAC,cAC1C/B,IAAA,OAAA4D,QAAA,cACI5D,IAAA,WACI+D,KAAK,CAAE,CAAEC,eAAe,CAAElD,UAAU,CAAC+B,MAAM,CAACrB,EAAE,CAAC,CAAG,OAAO,CAAG,KAAM,CAAE,CACpEyC,OAAO,CAAEA,CAAA,GAAMzB,qBAAqB,CAACK,MAAM,CAACrB,EAAE,CAAE,CAAAoC,QAAA,CAE/C9C,UAAU,CAAC+B,MAAM,CAACrB,EAAE,CAAC,CAAG,UAAU,CAAG,SAAS,CAC3C,CAAC,CACT,CAAC,GAVAqB,MAAM,CAACrB,EAWZ,CACP,CAAC,CACC,CAAC,EACL,CAAC,cACRxB,IAAA,WAAQ2D,SAAS,CAAC,eAAe,CAACM,OAAO,CAAEtB,eAAgB,CAAAiB,QAAA,CAAC,kBAAgB,CAAQ,CAAC,EACpF,CAAC,cACN5D,IAAA,CAACL,cAAc,GAAE,CAAC,EACjB,CAAC,CAEd,CAAC,CAED,cAAe,CAAAM,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}